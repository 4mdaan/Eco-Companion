<%- include('../partials/head', { pageCSS: 'carrinho' }) %>

<%- include('../partials/header', { currentPage: 'pagamento' }) %>

<!-- Hero do Pagamento Boleto -->
<section class="pagamento-hero boleto-hero">
  <section class="container">
    <h1 class="pagamento-title inter-font">üìÑ Pagamento via Boleto</h1>
    <p class="pagamento-subtitle">Pague em qualquer banco, lot√©rica ou aplicativo</p>
    
    <!-- Progress Steps -->
    <section class="checkout-steps">
      <section class="step completed">
        <section class="step-number">1</section>
        <section class="step-label">Carrinho</section>
      </section>
      <section class="step completed">
        <section class="step-number">2</section>
        <section class="step-label">Checkout</section>
      </section>
      <section class="step active">
        <section class="step-number">3</section>
        <section class="step-label">Pagamento</section>
      </section>
      <section class="step">
        <section class="step-number">4</section>
        <section class="step-label">Confirma√ß√£o</section>
      </section>
    </section>
  </section>
</section>

<!-- Conte√∫do do Pagamento Boleto -->
<section class="pagamento-content">
  <section class="container">
    <section class="boleto-grid">
      <!-- Boleto Principal -->
      <section class="boleto-container">
        <section class="boleto-header">
          <h2 class="boleto-title inter-font">Seu Boleto Banc√°rio</h2>
          <p class="boleto-subtitle">Imprima ou salve o PDF para efetuar o pagamento</p>
        </section>

        <!-- Dados do Boleto -->
        <section class="boleto-dados">
          <section class="boleto-visual">
            <section class="boleto-top">
              <section class="banco-info">
                <section class="banco-logo">üè¶</section>
                <section class="banco-dados">
                  <h3>Banco Ita√∫ S.A.</h3>
                  <span class="banco-codigo"><%= boleto.codigoBanco %></span>
                </section>
              </section>
              
              <section class="linha-digitavel">
                <h4>Linha Digit√°vel:</h4>
                <span class="codigo-barras-texto"><%= boleto.linhaDigitavel %></span>
              </section>
            </section>

            <section class="boleto-info-grid">
              <section class="info-item">
                <label>Benefici√°rio:</label>
                <span><%= boleto.beneficiario %></span>
              </section>
              
              <section class="info-item">
                <label>CNPJ:</label>
                <span><%= boleto.cnpj %></span>
              </section>
              
              <section class="info-item">
                <label>Nosso N√∫mero:</label>
                <span><%= boleto.nossoNumero %></span>
              </section>
              
              <section class="info-item">
                <label>Vencimento:</label>
                <span class="vencimento"><%= boleto.vencimento %></span>
              </section>
              
              <section class="info-item valor-destaque">
                <label>Valor:</label>
                <span class="valor-boleto">R$ <%= total.toLocaleString('pt-BR') %></span>
              </section>
            </section>

            <!-- C√≥digo de Barras Visual -->
            <section class="codigo-barras-visual">
              <h4>C√≥digo de Barras:</h4>
              <section class="barcode">
                <% for(let i = 0; i < 50; i++) { %>
                  <span class="bar <%= Math.random() > 0.5 ? 'thick' : 'thin' %>"></span>
                <% } %>
              </section>
              <span class="codigo-barras-numero"><%= boleto.codigoBarras %></span>
            </section>
          </section>
        </section>

        <!-- Instru√ß√µes de Pagamento -->
        <section class="boleto-instrucoes">
          <h3 class="inter-font">üìã Instru√ß√µes de Pagamento:</h3>
          <ol class="instrucoes-list">
            <li>
              <strong>Imprima este boleto</strong>
              <p>Use o bot√£o "Imprimir Boleto" abaixo ou salve como PDF</p>
            </li>
            <li>
              <strong>Pague at√© o vencimento</strong>
              <p>Pagamento pode ser feito em bancos, lot√©ricas, aplicativos ou internet banking</p>
            </li>
            <li>
              <strong>Ap√≥s o pagamento</strong>
              <p>A confirma√ß√£o pode levar at√© 3 dias √∫teis</p>
            </li>
            <li>
              <strong>Acompanhe o status</strong>
              <p>Voc√™ receber√° emails de confirma√ß√£o e atualiza√ß√µes</p>
            </li>
          </ol>
        </section>

        <!-- A√ß√µes do Boleto -->
        <section class="boleto-actions">
          <button type="button" onclick="window.print()" class="btn-imprimir">
            üñ®Ô∏è Imprimir Boleto
          </button>
          
          <button type="button" id="btnCopiarLinha" class="btn-copiar">
            üìã Copiar Linha Digit√°vel
          </button>
          
          <button type="button" onclick="history.back()" class="btn-voltar">
            ‚Üê Escolher outro m√©todo
          </button>
        </section>

        <!-- Alerta de Vencimento -->
        <section class="boleto-alerta">
          <section class="alerta-icon">‚ö†Ô∏è</section>
          <section class="alerta-content">
            <h4>Aten√ß√£o ao Vencimento!</h4>
            <p>
              Este boleto vence em <strong><%= boleto.vencimento %></strong>. 
              Ap√≥s o vencimento, ser√° gerada uma nova cobran√ßa com juros.
            </p>
          </section>
        </section>
      </section>

      <!-- Resumo do Pedido -->
      <section class="resumo-pedido">
        <h3 class="resumo-title">üìã Resumo do Pedido</h3>
        
        <section class="itens-resumo">
          <% carrinho.forEach(function(item) { %>
            <section class="item-resumo">
              <section class="item-image <%= item.bgClass %>"></section>
              <section class="item-details">
                <h4 class="item-nome"><%= item.destino %></h4>
                <p class="item-periodo"><%= item.periodo %></p>
                <section class="item-preco">
                  <span class="quantidade"><%= item.quantidade %>x</span>
                  <span class="preco">R$ <%= item.preco %></span>
                </section>
              </section>
            </section>
          <% }); %>
        </section>

        <section class="total-resumo">
          <section class="total-item">
            <span class="total-label">Subtotal:</span>
            <span class="total-valor">R$ <%= total.toLocaleString('pt-BR') %></span>
          </section>
          <section class="total-item total-final">
            <span class="total-label">Total do Boleto:</span>
            <span class="total-valor">R$ <%= total.toLocaleString('pt-BR') %></span>
          </section>
        </section>

        <!-- Informa√ß√µes do Boleto -->
        <section class="boleto-info">
          <h4 class="info-title">üíº Informa√ß√µes do Boleto:</h4>
          <ul class="info-list">
            <li>üìÖ Vencimento: <%= boleto.vencimento %></li>
            <li>üè¶ Banco: Ita√∫ (341)</li>
            <li>üìÑ Nosso N√∫mero: <%= boleto.nossoNumero %></li>
            <li>‚è±Ô∏è Processamento: at√© 3 dias √∫teis</li>
          </ul>
        </section>

        <!-- M√©todos alternativos -->
        <section class="metodos-alternativos">
          <h4 class="alt-title">Pagamento mais r√°pido:</h4>
          <section class="alt-buttons">
            <a href="/carrinho/pagamento/pix" class="btn-alt destaque">
              üî≤ PIX (Instant√¢neo + 2% desconto)
            </a>
            <a href="/carrinho/pagamento/cartao" class="btn-alt">
              üí≥ Cart√£o
            </a>
          </section>
        </section>
      </section>
    </section>
  </section>
</section>



<script>
document.addEventListener('DOMContentLoaded', function() {
  // Copiar linha digit√°vel
  document.getElementById('btnCopiarLinha').addEventListener('click', function() {
    const linhaDigitavel = '<%= boleto.linhaDigitavel %>';
    
    // Criar elemento tempor√°rio para copiar
    const tempInput = document.createElement('input');
    tempInput.value = linhaDigitavel;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);
    
    // Feedback visual
    this.innerHTML = '‚úÖ Linha Copiada!';
    this.style.background = '#10b981';
    
    setTimeout(() => {
      this.innerHTML = 'üìã Copiar Linha Digit√°vel';
      this.style.background = '';
    }, 2000);
  });
  
  // Fun√ß√£o para calcular dias at√© vencimento
  function calcularDiasVencimento() {
    const hoje = new Date();
    const vencimento = new Date('<%= boleto.vencimento.split('/').reverse().join('-') %>');
    const diffTime = vencimento - hoje;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    return diffDays;
  }
  
  // Mostrar alerta se pr√≥ximo do vencimento
  const diasVencimento = calcularDiasVencimento();
  if (diasVencimento <= 1) {
    const alerta = document.querySelector('.boleto-alerta');
    alerta.style.background = '#fee2e2';
    alerta.style.borderColor = '#dc2626';
    
    if (diasVencimento < 0) {
      alerta.querySelector('h4').textContent = 'Boleto Vencido!';
      alerta.querySelector('p').innerHTML = 'Este boleto j√° venceu. <a href="/carrinho/pagamento/pix">Clique aqui para pagar via PIX</a> ou gere um novo boleto.';
    } else if (diasVencimento === 0) {
      alerta.querySelector('h4').textContent = 'Vence Hoje!';
      alerta.querySelector('p').textContent = 'Este boleto vence hoje. Pague o quanto antes para evitar juros.';
    }
  }
  
  // Validar impress√£o
  window.addEventListener('beforeprint', function() {
    console.log('Preparando impress√£o do boleto...');
  });
  
  window.addEventListener('afterprint', function() {
    console.log('Impress√£o conclu√≠da');
    
    // Opcional: redirecionar para p√°gina de acompanhamento
    setTimeout(() => {
      if (confirm('Deseja acompanhar o status do seu pagamento?')) {
        window.location.href = '/pedidos/acompanhar';
      }
    }, 1000);
  });
});
</script>

<style>
/* Estilos espec√≠ficos para impress√£o */
@media print {
  .pagamento-hero,
  .checkout-steps,
  .boleto-actions,
  .metodos-alternativos,
  .resumo-pedido,
  .pagamento-hero,
  header,
  footer {
    display: none !important;
  }
  
  .boleto-container {
    width: 100%;
    margin: 0;
    padding: 20px;
  }
  
  .boleto-visual {
    border: 2px solid #000;
    padding: 20px;
  }
  
  .linha-digitavel {
    font-size: 14px;
    font-weight: bold;
  }
  
  .barcode {
    height: 50px;
    margin: 10px 0;
  }
}


</style>

<%- include('../partials/footer') %>
<%- include('../partials/scripts') %>