<%- include('../partials/head', { pageCSS: 'destino-compra' }) %>

<%- include('../partials/header', { currentPage: 'destinos' }) %>

<!-- Hero da Compra -->
<section class="compra-hero">
  <section class="container">
    <section class="compra-breadcrumb">
      <a href="/destinos">Destinos</a>
      <span>‚Ä∫</span>
      <a href="/destinos/<%= destino.slug %>"><%= destino.nome %></a>
      <span>‚Ä∫</span>
      <span>Comprar</span>
    </section>
    <h1 class="compra-title">Finalizar Reserva</h1>
    <p class="compra-subtitle">Complete seus dados para confirmar sua viagem para <strong><%= destino.nome %></strong></p>
  </section>
</section>

<!-- Conte√∫do da Compra -->
<section class="compra-content">
  <section class="container">
    <form method="POST" action="/destinos/<%= destino.slug %>/comprar" class="compra-form">
      <section class="compra-grid">
        <!-- Formul√°rio de Dados -->
        <section class="compra-dados">
          <!-- Informa√ß√µes da Viagem -->
          <section class="form-section">
            <h2 class="section-title">üìÖ Detalhes da Viagem</h2>
            
            <section class="form-row">
              <section class="form-group">
                <label for="pessoas" class="form-label">N√∫mero de Pessoas *</label>
                <input type="number" id="pessoas" name="pessoas" class="form-input" 
                       min="1" value="2" required 
                       placeholder="Digite o n√∫mero de pessoas">
                <small class="form-hint">M√≠nimo 1 pessoa</small>
              </section>
              
              <section class="form-group">
                <label for="dataViagem" class="form-label">Data da Viagem *</label>
                <input type="date" id="dataViagem" name="dataViagem" class="form-input" required>
              </section>
            </section>
          </section>

          <!-- Dados Pessoais -->
          <section class="form-section">
            <h2 class="section-title">üë§ Dados Pessoais</h2>
            
            <section class="form-row">
              <section class="form-group">
                <label for="nome" class="form-label">Nome Completo *</label>
                <input type="text" id="nome" name="nome" class="form-input" required>
              </section>
            </section>
            
            <section class="form-row">
              <section class="form-group">
                <label for="email" class="form-label">E-mail *</label>
                <input type="email" id="email" name="email" class="form-input" required>
              </section>
              
              <section class="form-group">
                <label for="telefone" class="form-label">Telefone *</label>
                <input type="tel" id="telefone" name="telefone" class="form-input" required>
              </section>
            </section>
            
            <section class="form-row">
              <section class="form-group">
                <label for="cpf" class="form-label">CPF *</label>
                <input type="text" id="cpf" name="cpf" class="form-input" required>
              </section>
              
              <section class="form-group">
                <label for="nascimento" class="form-label">Data de Nascimento *</label>
                <input type="date" id="nascimento" name="nascimento" class="form-input" required>
              </section>
            </section>
          </section>

          <!-- Endere√ßo -->
          <section class="form-section">
            <h2 class="section-title">üè† Endere√ßo</h2>
            
            <section class="form-row">
              <section class="form-group">
                <label for="cep" class="form-label">CEP *</label>
                <input type="text" id="cep" name="endereco[cep]" class="form-input" required>
              </section>
              
              <section class="form-group">
                <label for="cidade" class="form-label">Cidade *</label>
                <input type="text" id="cidade" name="endereco[cidade]" class="form-input" required>
              </section>
              
              <section class="form-group">
                <label for="estado" class="form-label">Estado *</label>
                <select id="estado" name="endereco[estado]" class="form-input" required>
                  <option value="">Selecione...</option>
                  <option value="AC">Acre</option>
                  <option value="AL">Alagoas</option>
                  <option value="AP">Amap√°</option>
                  <option value="AM">Amazonas</option>
                  <option value="BA">Bahia</option>
                  <option value="CE">Cear√°</option>
                  <option value="DF">Distrito Federal</option>
                  <option value="ES">Esp√≠rito Santo</option>
                  <option value="GO">Goi√°s</option>
                  <option value="MA">Maranh√£o</option>
                  <option value="MT">Mato Grosso</option>
                  <option value="MS">Mato Grosso do Sul</option>
                  <option value="MG">Minas Gerais</option>
                  <option value="PA">Par√°</option>
                  <option value="PB">Para√≠ba</option>
                  <option value="PR">Paran√°</option>
                  <option value="PE">Pernambuco</option>
                  <option value="PI">Piau√≠</option>
                  <option value="RJ">Rio de Janeiro</option>
                  <option value="RN">Rio Grande do Norte</option>
                  <option value="RS">Rio Grande do Sul</option>
                  <option value="RO">Rond√¥nia</option>
                  <option value="RR">Roraima</option>
                  <option value="SC">Santa Catarina</option>
                  <option value="SP">S√£o Paulo</option>
                  <option value="SE">Sergipe</option>
                  <option value="TO">Tocantins</option>
                </select>
              </section>
            </section>
            
            <section class="form-row">
              <section class="form-group">
                <label for="endereco" class="form-label">Endere√ßo *</label>
                <input type="text" id="endereco" name="endereco[logradouro]" class="form-input" required>
              </section>
              
              <section class="form-group">
                <label for="numero" class="form-label">N√∫mero *</label>
                <input type="text" id="numero" name="endereco[numero]" class="form-input" required>
              </section>
              
              <section class="form-group">
                <label for="complemento" class="form-label">Complemento</label>
                <input type="text" id="complemento" name="endereco[complemento]" class="form-input">
              </section>
            </section>
          </section>
          
          <!-- M√©todo de Pagamento -->
          <section class="form-section">
            <h2 class="section-title">üí≥ Forma de Pagamento</h2>
            
            <section class="payment-methods">
              <section class="payment-option">
                <input type="radio" id="cartao" name="metodoPagamento" value="cartao" checked>
                <label for="cartao" class="payment-label">
                  <section class="payment-icon">üí≥</section>
                  <section class="payment-info">
                    <section class="payment-title">Cart√£o de Cr√©dito</section>
                    <section class="payment-desc">Visa, Mastercard, Elo - Parcelamento em at√© 12x</section>
                  </section>
                </label>
              </section>
              
              <section class="payment-option">
                <input type="radio" id="pix" name="metodoPagamento" value="pix">
                <label for="pix" class="payment-label">
                  <section class="payment-icon">üì±</section>
                  <section class="payment-info">
                    <section class="payment-title">PIX</section>
                    <section class="payment-desc">Pagamento instant√¢neo com desconto de 5%</section>
                  </section>
                </label>
              </section>
              
              <section class="payment-option">
                <input type="radio" id="boleto" name="metodoPagamento" value="boleto">
                <label for="boleto" class="payment-label">
                  <section class="payment-icon">üßæ</section>
                  <section class="payment-info">
                    <section class="payment-title">Boleto Banc√°rio</section>
                    <section class="payment-desc">Vence em 3 dias √∫teis</section>
                  </section>
                </label>
              </section>
            </section>
          </section>
        </section>
        
        <!-- Resumo da Reserva -->
        <section class="compra-resumo">
          <section class="resumo-card">
            <h3 class="resumo-title">Resumo da Reserva</h3>
            
            <!-- Destino -->
            <section class="destino-resumo">
              <section class="destino-image" style="background-image: url('<%= destino.imagem %>')"></section>
              <section class="destino-info">
                <h4 class="destino-nome"><%= destino.nome %></h4>
                <p class="destino-categoria"><%= destino.categoria %></p>
                <section class="destino-rating">
                  <% for(let i = 1; i <= 5; i++) { %>
                    <span class="star <%= i <= Math.floor(destino.avaliacaoMedia) ? 'filled' : '' %>">‚òÖ</span>
                  <% } %>
                  <span class="rating-number">(<%= destino.avaliacaoMedia %>)</span>
                </section>
              </section>
            </section>

            <!-- Incluso no Pacote -->
            <section class="pacote-incluso">
              <h4 class="incluso-title">‚ú® Incluso no Pacote:</h4>
              <ul class="incluso-list">
                <% destino.incluso.forEach(function(item) { %>
                  <li><%= item %></li>
                <% }); %>
              </ul>
              <% if (destino.duracao) { %>
                <section class="duracao">
                  <strong>‚è±Ô∏è Dura√ß√£o:</strong> <%= destino.duracao %>
                </section>
              <% } %>
            </section>
            
            <!-- Valores -->
            <section class="resumo-valores">
              <section class="resumo-linha">
                <span class="resumo-label">Valor por pessoa:</span>
                <span class="resumo-valor">R$ <%= destino.preco.toLocaleString('pt-BR') %></span>
              </section>
              
              <section class="resumo-linha quantidade-linha">
                <span class="resumo-label">Quantidade:</span>
                <span class="resumo-valor quantidade-display">2 pessoas</span>
              </section>
              
              <section class="resumo-linha subtotal-linha">
                <span class="resumo-label">Subtotal:</span>
                <span class="resumo-valor subtotal-valor">R$ <%= (destino.preco * 2).toLocaleString('pt-BR') %></span>
              </section>
              
              <section class="resumo-linha desconto-linha" style="display: none;">
                <span class="resumo-label">Desconto PIX (5%):</span>
                <span class="resumo-valor desconto-valor">- R$ 0</span>
              </section>
            </section>
            
            <section class="resumo-divider"></section>
            
            <section class="resumo-total">
              <span class="total-label">Total:</span>
              <span class="total-valor" data-valor="<%= destino.preco %>">R$ <%= (destino.preco * 2).toLocaleString('pt-BR') %></span>
            </section>
            
            <!-- Bot√µes -->
            <section class="compra-actions">
              <% if (destino.categoria === 'Ultra Luxury') { %>
                <button type="submit" class="btn-finalizar luxury">
                  üëë Solicitar Consultoria VIP
                </button>
              <% } else { %>
                <button type="submit" class="btn-finalizar">
                  üõí Finalizar Compra
                </button>
              <% } %>
              
              <a href="/destinos/<%= destino.slug %>" class="btn-voltar">
                ‚Üê Voltar aos Detalhes
              </a>
            </section>
            
            <!-- Seguran√ßa -->
            <section class="compra-seguranca">
              <section class="seguranca-item">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M8 0c-.69 0-1.843.265-2.928.56-1.11.3-2.229.655-2.887.87a1.54 1.54 0 0 0-1.044 1.262c-.596 4.477.787 7.795 2.465 9.99a11.777 11.777 0 0 0 2.517 2.453c.386.273.744.482 1.048.625.28.132.581.24.829.24s.548-.108.829-.24c.304-.143.662-.352 1.048-.625a11.777 11.777 0 0 0 2.517-2.453c1.678-2.195 3.061-5.513 2.465-9.99a1.541 1.541 0 0 0-1.044-1.263 62.467 62.467 0 0 0-5.794-1.187A63.44 63.44 0 0 0 8 0z"/>
                </svg>
                <span>Pagamento 100% Seguro</span>
              </section>
              
              <section class="seguranca-item">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1zm3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4h-3.5zM2 5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V5z"/>
                </svg>
                <span>Dados Protegidos SSL</span>
              </section>
              
              <section class="seguranca-item">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M2 2a2 2 0 0 0-2 2v8.01A2 2 0 0 0 2 14h5.5a.5.5 0 0 0 0-1H2a1 1 0 0 1-.966-.741l5.64-3.471L8 9.583l7-4.2V8.5a.5.5 0 0 0 1 0V4a2 2 0 0 0-2-2H2zm3.708 6.208L1 11.105V5.383l4.708 2.825zM1 4.217V4a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v.217l-7 4.2-7-4.2z"/>
                </svg>
                <span>Confirma√ß√£o por E-mail</span>
              </section>
            </section>
          </section>
        </section>
      </section>
    </form>
  </section>
</section>

<%- include('../partials/footer') %>

<!-- JavaScript para interatividade -->
<script>
// Fun√ß√£o para atualizar c√°lculos
function atualizarCalculos() {
  const pessoas = parseInt(document.getElementById('pessoas').value) || 1;
  const metodoPagamento = document.querySelector('input[name="metodoPagamento"]:checked').value;
  const valorUnitario = parseInt(document.querySelector('.total-valor').getAttribute('data-valor'));
  
  // Atualizar quantidade
  const quantidadeDisplay = document.querySelector('.quantidade-display');
  quantidadeDisplay.textContent = pessoas === 1 ? '1 pessoa' : `${pessoas} pessoas`;
  
  // Calcular subtotal
  const subtotal = valorUnitario * pessoas;
  document.querySelector('.subtotal-valor').textContent = `R$ ${subtotal.toLocaleString('pt-BR')}`;
  
  // Calcular desconto PIX
  const descontoLinha = document.querySelector('.desconto-linha');
  const descontoValor = document.querySelector('.desconto-valor');
  let desconto = 0;
  
  if (metodoPagamento === 'pix') {
    desconto = Math.round(subtotal * 0.05);
    descontoLinha.style.display = 'flex';
    descontoValor.textContent = `- R$ ${desconto.toLocaleString('pt-BR')}`;
  } else {
    descontoLinha.style.display = 'none';
  }
  
  // Calcular total
  const total = subtotal - desconto;
  document.querySelector('.total-valor').textContent = `R$ ${total.toLocaleString('pt-BR')}`;
}

// Event listeners
document.getElementById('pessoas').addEventListener('change', atualizarCalculos);
document.querySelectorAll('input[name="metodoPagamento"]').forEach(input => {
  input.addEventListener('change', atualizarCalculos);
});

// M√°scara para CPF
document.getElementById('cpf').addEventListener('input', function(e) {
  let value = e.target.value.replace(/\D/g, '');
  value = value.replace(/(\d{3})(\d)/, '$1.$2');
  value = value.replace(/(\d{3})(\d)/, '$1.$2');
  value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
  e.target.value = value;
});

// M√°scara para telefone
document.getElementById('telefone').addEventListener('input', function(e) {
  let value = e.target.value.replace(/\D/g, '');
  value = value.replace(/(\d{2})(\d)/, '($1) $2');
  value = value.replace(/(\d{5})(\d)/, '$1-$2');
  e.target.value = value;
});

// Buscar CEP
document.getElementById('cep').addEventListener('blur', function(e) {
  const cep = e.target.value.replace(/\D/g, '');
  if (cep.length === 8) {
    fetch(`https://viacep.com.br/ws/${cep}/json/`)
      .then(response => response.json())
      .then(data => {
        if (!data.erro) {
          document.getElementById('cidade').value = data.localidade;
          document.getElementById('endereco').value = data.logradouro;
          document.getElementById('estado').value = data.uf;
        }
      })
      .catch(error => console.log('Erro ao buscar CEP:', error));
  }
});

// Inicializar c√°lculos
atualizarCalculos();
</script>

<%- include('../partials/scripts') %>
